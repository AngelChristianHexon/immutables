


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > OkJsons</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.immutables.value.processor</a>
</div>

<h1>Coverage Summary for Class: OkJsons (org.immutables.value.processor)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">OkJsons</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/25)
  </span>
</td>
</tr>
  <tr>
    <td class="name">OkJsons$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$AdapterDecider</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/98)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/75)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$AdapterDecider$AdaptedUse</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$AdapterDecider$AdapterSpecifier</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$AdapterDecider$LocalEnumUse</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$AttributesByFirstLetter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$ConvertionDirection</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$EnumAllDefinitions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/30)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$EnumConstant</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$EnumDefinition</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$OkTypeAdapterTypes</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$OkTypeAdapterTypes$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">OkJsons$OkTypeAdapterTypes$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/48)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/152)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/199)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp;   Copyright 2015-2018 Immutables Authors and Contributors
&nbsp;
&nbsp;   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp;   you may not use this file except in compliance with the License.
&nbsp;   You may obtain a copy of the License at
&nbsp;
&nbsp;       http://www.apache.org/licenses/LICENSE-2.0
&nbsp;
&nbsp;   Unless required by applicable law or agreed to in writing, software
&nbsp;   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp;   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp;   See the License for the specific language governing permissions and
&nbsp;   limitations under the License.
&nbsp; */
&nbsp;package org.immutables.value.processor;
&nbsp;
&nbsp;import com.google.common.base.CaseFormat;
&nbsp;import com.google.common.base.Function;
&nbsp;import com.google.common.base.Optional;
&nbsp;import com.google.common.base.Predicate;
&nbsp;import com.google.common.collect.HashMultimap;
&nbsp;import com.google.common.collect.ImmutableList;
&nbsp;import com.google.common.collect.ImmutableMultimap;
&nbsp;import com.google.common.collect.Iterables;
&nbsp;import com.google.common.collect.Maps;
&nbsp;import com.google.common.collect.Multimap;
&nbsp;import com.google.common.collect.Sets;
&nbsp;import java.util.Collection;
&nbsp;import java.util.EnumSet;
&nbsp;import java.util.IdentityHashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Map.Entry;
&nbsp;import java.util.Set;
&nbsp;import javax.annotation.Nullable;
&nbsp;import javax.lang.model.element.Element;
&nbsp;import javax.lang.model.element.ElementKind;
&nbsp;import javax.lang.model.element.TypeElement;
&nbsp;import org.immutables.generator.Generator;
&nbsp;import org.immutables.value.Value;
&nbsp;import org.immutables.value.processor.meta.OkNamedMirror;
&nbsp;import org.immutables.value.processor.meta.Proto.AbstractDeclaring;
&nbsp;import org.immutables.value.processor.meta.Proto.DeclaringType;
&nbsp;import org.immutables.value.processor.meta.Proto.Protoclass;
&nbsp;import org.immutables.value.processor.meta.ValueAttribute;
&nbsp;import org.immutables.value.processor.meta.ValueType;
&nbsp;
&nbsp;//@Generator.Template
<b class="nc">&nbsp;abstract class OkJsons extends ValuesTemplate {</b>
&nbsp;
&nbsp;  @Generator.Typedef
&nbsp;  OkTypeAdapterTypes Adapted;
&nbsp;
&nbsp;  @Generator.Typedef
&nbsp;  AttributesByFirstLetter Mm;
&nbsp;
&nbsp;  @Value.Immutable
<b class="nc">&nbsp;  abstract static class OkTypeAdapterTypes {</b>
&nbsp;    abstract AbstractDeclaring definedBy();
&nbsp;    abstract String packageGenerated();
&nbsp;    abstract List&lt;ValueType&gt; types();
&nbsp;
&nbsp;    @Value.Derived
&nbsp;    EnumAllDefinitions enums() {
<b class="nc">&nbsp;      return new EnumAllDefinitions(types(), definedBy());</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    final Function&lt;ValueAttribute, AdapterDecider&gt; decider = new Function&lt;ValueAttribute, AdapterDecider&gt;() {</b>
<b class="nc">&nbsp;      private final IdentityHashMap&lt;ValueAttribute, AdapterDecider&gt; cache = Maps.newIdentityHashMap();</b>
&nbsp;
&nbsp;      @Override
&nbsp;      public AdapterDecider apply(ValueAttribute input) {
<b class="nc">&nbsp;        AdapterDecider d = cache.get(input);</b>
<b class="nc">&nbsp;        if (d == null) {</b>
<b class="nc">&nbsp;          d = new AdapterDecider(input, enums());</b>
<b class="nc">&nbsp;          cache.put(input, d);</b>
&nbsp;        }
<b class="nc">&nbsp;        return d;</b>
&nbsp;      }
&nbsp;    };
&nbsp;
<b class="nc">&nbsp;    final Predicate&lt;ValueType&gt; requireAdapters = new Predicate&lt;ValueType&gt;() {</b>
&nbsp;      @Override
&nbsp;      public boolean apply(@Nullable ValueType input) {
<b class="nc">&nbsp;        for (AdapterDecider d : Iterables.transform(input.allMarshalingAttributes(), decider)) {</b>
<b class="nc">&nbsp;          if (d.useAdapter()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;          }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return false;</b>
&nbsp;      }
&nbsp;    };
&nbsp;  }
&nbsp;
&nbsp;  @Generator.Typedef
&nbsp;  AdapterDecider Decider;
&nbsp;
&nbsp;  static class AdapterDecider {
&nbsp;    final ValueAttribute attribute;
&nbsp;    private final EnumAllDefinitions enums;
&nbsp;    private final AdaptedUse adapterUse;
&nbsp;    private final LocalEnumUse enumUse;
&nbsp;
<b class="nc">&nbsp;    AdapterDecider(ValueAttribute attribute, EnumAllDefinitions enums) {</b>
<b class="nc">&nbsp;      this.attribute = attribute;</b>
<b class="nc">&nbsp;      this.enums = enums;</b>
<b class="nc">&nbsp;      this.adapterUse = inferAdapter();</b>
<b class="nc">&nbsp;      this.enumUse = inferEnum();</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    private enum AdaptedUse {</b>
<b class="nc">&nbsp;      NONE, FULL, FIRST, SECOND, BOTH;</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    private enum LocalEnumUse {</b>
<b class="nc">&nbsp;      NONE, FULL, FIRST, SECOND, BOTH;</b>
&nbsp;    }
&nbsp;
&nbsp;    private AdaptedUse inferAdapter() {
<b class="nc">&nbsp;      if (!attribute.getJsonQualiferAnnotations().isEmpty()) {</b>
<b class="nc">&nbsp;        return AdaptedUse.FULL;</b>
&nbsp;      }
<b class="nc">&nbsp;      if (attribute.isOptionalType() || attribute.isCollectionType() || attribute.isArrayType()) {</b>
<b class="nc">&nbsp;        if (attribute.isRequiresMarshalingAdapter()</b>
<b class="nc">&nbsp;            &amp;&amp; !enums.definitionsByQualifiedName.containsKey(attribute.firstTypeParameter())) {</b>
<b class="nc">&nbsp;          return AdaptedUse.FIRST;</b>
&nbsp;        }
<b class="nc">&nbsp;        return AdaptedUse.NONE;</b>
&nbsp;      }
<b class="nc">&nbsp;      if (attribute.isMapType()) {</b>
<b class="nc">&nbsp;        if (attribute.isRequiresMarshalingAdapter()</b>
<b class="nc">&nbsp;            &amp;&amp; !enums.definitionsByQualifiedName.containsKey(attribute.firstTypeParameter())) {</b>
<b class="nc">&nbsp;          return AdaptedUse.FIRST;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (attribute.isRequiresMarshalingSecondaryAdapter()</b>
<b class="nc">&nbsp;            &amp;&amp; !enums.definitionsByQualifiedName.containsKey(attribute.secondTypeParameter())) {</b>
<b class="nc">&nbsp;          return AdaptedUse.SECOND;</b>
&nbsp;        }
<b class="nc">&nbsp;        return AdaptedUse.NONE;</b>
&nbsp;      }
<b class="nc">&nbsp;      if (attribute.isRequiresMarshalingAdapter()</b>
<b class="nc">&nbsp;          &amp;&amp; !enums.definitionsByQualifiedName.containsKey(attribute.getType())) {</b>
<b class="nc">&nbsp;        return AdaptedUse.FULL;</b>
&nbsp;      }
<b class="nc">&nbsp;      return AdaptedUse.NONE;</b>
&nbsp;    }
&nbsp;
&nbsp;    private LocalEnumUse inferEnum() {
<b class="nc">&nbsp;      if (adapterUse == AdaptedUse.FULL) {</b>
<b class="nc">&nbsp;        return LocalEnumUse.NONE;</b>
&nbsp;      }
&nbsp;
<b class="nc">&nbsp;      if (adapterUse != AdaptedUse.FIRST &amp;&amp; adapterUse != AdaptedUse.BOTH) {</b>
<b class="nc">&nbsp;        if (attribute.isOptionalType() || attribute.isCollectionType() || attribute.isArrayType()) {</b>
<b class="nc">&nbsp;          if (attribute.isRequiresMarshalingAdapter()</b>
<b class="nc">&nbsp;              &amp;&amp; enums.definitionsByQualifiedName.containsKey(attribute.firstTypeParameter())) {</b>
<b class="nc">&nbsp;            return LocalEnumUse.FIRST;</b>
&nbsp;          }
<b class="nc">&nbsp;          return LocalEnumUse.NONE;</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;      if (adapterUse != AdaptedUse.BOTH) {</b>
<b class="nc">&nbsp;        if (attribute.isMapType()) {</b>
<b class="nc">&nbsp;          if (attribute.isRequiresMarshalingAdapter()</b>
<b class="nc">&nbsp;              &amp;&amp; enums.definitionsByQualifiedName.containsKey(attribute.firstTypeParameter())) {</b>
&nbsp;
<b class="nc">&nbsp;            if (adapterUse != AdaptedUse.SECOND) {</b>
<b class="nc">&nbsp;              if (attribute.isRequiresMarshalingSecondaryAdapter()</b>
<b class="nc">&nbsp;                  &amp;&amp; enums.definitionsByQualifiedName.containsKey(attribute.secondTypeParameter())) {</b>
<b class="nc">&nbsp;                return LocalEnumUse.BOTH;</b>
&nbsp;              }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return LocalEnumUse.FIRST;</b>
&nbsp;          }
&nbsp;
<b class="nc">&nbsp;          if (adapterUse != AdaptedUse.SECOND) {</b>
<b class="nc">&nbsp;            if (attribute.isRequiresMarshalingSecondaryAdapter()</b>
<b class="nc">&nbsp;                &amp;&amp; enums.definitionsByQualifiedName.containsKey(attribute.secondTypeParameter())) {</b>
<b class="nc">&nbsp;              return LocalEnumUse.SECOND;</b>
&nbsp;            }
&nbsp;          }
&nbsp;
<b class="nc">&nbsp;          return LocalEnumUse.NONE;</b>
&nbsp;        }
&nbsp;      }
&nbsp;
<b class="nc">&nbsp;      if (attribute.isRequiresMarshalingAdapter()</b>
<b class="nc">&nbsp;          &amp;&amp; !enums.definitionsByQualifiedName.containsKey(attribute.getType())) {</b>
<b class="nc">&nbsp;        return LocalEnumUse.FULL;</b>
&nbsp;      }
&nbsp;
<b class="nc">&nbsp;      return LocalEnumUse.NONE;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isSimple() {
<b class="nc">&nbsp;      return adapterUse == AdaptedUse.FULL</b>
&nbsp;          || enumUse == LocalEnumUse.FULL
<b class="nc">&nbsp;          || attribute.typeKind().isRegular();</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isComplex() {
<b class="nc">&nbsp;      return !isSimple();</b>
&nbsp;    }
&nbsp;
&nbsp;    boolean useEnum() {
<b class="nc">&nbsp;      return enumUse != LocalEnumUse.NONE;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Nullable
&nbsp;    EnumDefinition enumFull() {
<b class="nc">&nbsp;      if (enumUse == LocalEnumUse.FULL) {</b>
<b class="nc">&nbsp;        return enums.apply(attribute.getType());</b>
&nbsp;      }
<b class="nc">&nbsp;      return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Nullable
&nbsp;    EnumDefinition enumFirst() {
<b class="nc">&nbsp;      if (enumUse == LocalEnumUse.FIRST || enumUse == LocalEnumUse.BOTH) {</b>
<b class="nc">&nbsp;        return enums.apply(attribute.firstTypeParameter());</b>
&nbsp;      }
<b class="nc">&nbsp;      return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Nullable
&nbsp;    EnumDefinition enumSecond() {
<b class="nc">&nbsp;      if (enumUse == LocalEnumUse.SECOND || enumUse == LocalEnumUse.BOTH) {</b>
<b class="nc">&nbsp;        return enums.apply(attribute.secondTypeParameter());</b>
&nbsp;      }
<b class="nc">&nbsp;      return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    boolean useAdapter() {
<b class="nc">&nbsp;      return adapterUse != AdaptedUse.NONE;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Nullable
&nbsp;    AdapterSpecifier adapterFull() {
<b class="nc">&nbsp;      if (adapterUse == AdaptedUse.FULL) {</b>
<b class="nc">&nbsp;        if (!attribute.getJsonQualiferAnnotations().isEmpty()) {</b>
<b class="nc">&nbsp;          return new AdapterSpecifier(attribute.getType(), true);</b>
&nbsp;        }
<b class="nc">&nbsp;        return AdapterSpecifier.from(attribute.getType());</b>
&nbsp;      }
<b class="nc">&nbsp;      return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Nullable
&nbsp;    AdapterSpecifier adapterFirst() {
<b class="nc">&nbsp;      if (adapterUse == AdaptedUse.FIRST || adapterUse == AdaptedUse.BOTH) {</b>
<b class="nc">&nbsp;        return AdapterSpecifier.from(attribute.firstTypeParameter());</b>
&nbsp;      }
<b class="nc">&nbsp;      return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Nullable
&nbsp;    AdapterSpecifier adapterSecond() {
<b class="nc">&nbsp;      if (adapterUse == AdaptedUse.SECOND || adapterUse == AdaptedUse.BOTH) {</b>
<b class="nc">&nbsp;        return AdapterSpecifier.from(attribute.secondTypeParameter());</b>
&nbsp;      }
<b class="nc">&nbsp;      return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    static class AdapterSpecifier {
&nbsp;      final String type;
&nbsp;      final boolean reflect;
&nbsp;
<b class="nc">&nbsp;      AdapterSpecifier(String type, boolean reflect) {</b>
<b class="nc">&nbsp;        this.type = type;</b>
<b class="nc">&nbsp;        this.reflect = reflect;</b>
&nbsp;      }
&nbsp;
&nbsp;      static AdapterSpecifier from(String type) {
<b class="nc">&nbsp;        return new AdapterSpecifier(type, type.indexOf(&#39;&lt;&#39;) &gt; 0);</b>
&nbsp;      }
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  OkTypeAdapterTypes adapted;
&nbsp;
<b class="nc">&nbsp;  final Function&lt;OkTypeAdapterTypes, Void&gt; setCurrent = new Function&lt;OkTypeAdapterTypes, Void&gt;() {</b>
&nbsp;    @Override
&nbsp;    public Void apply(OkTypeAdapterTypes input) {
<b class="nc">&nbsp;      adapted = input;</b>
<b class="nc">&nbsp;      return null;</b>
&nbsp;    }
&nbsp;  };
&nbsp;
&nbsp;  Iterable&lt;OkTypeAdapterTypes&gt; typeAdapters() {
<b class="nc">&nbsp;    Multimap&lt;AbstractDeclaring, ValueType&gt; byDeclaring = HashMultimap.create();</b>
<b class="nc">&nbsp;    for (ValueType value : values.values()) {</b>
<b class="nc">&nbsp;      Protoclass protoclass = value.constitution.protoclass();</b>
<b class="nc">&nbsp;      if (protoclass.kind().isValue()) {</b>
<b class="nc">&nbsp;        Optional&lt;AbstractDeclaring&gt; typeAdaptersProvider = protoclass.okTypeAdaptersProvider();</b>
<b class="nc">&nbsp;        if (typeAdaptersProvider.isPresent()) {</b>
<b class="nc">&nbsp;          byDeclaring.put(typeAdaptersProvider.get(), value);</b>
<b class="nc">&nbsp;        } else if (protoclass.okJsonTypeAdapters().isPresent()</b>
<b class="nc">&nbsp;            &amp;&amp; protoclass.declaringType().isPresent()) {</b>
<b class="nc">&nbsp;          DeclaringType topLevel = protoclass.declaringType().get().associatedTopLevel();</b>
<b class="nc">&nbsp;          byDeclaring.put(topLevel, value);</b>
&nbsp;        }
&nbsp;      }
<b class="nc">&nbsp;    }</b>
&nbsp;
<b class="nc">&nbsp;    ImmutableList.Builder&lt;OkTypeAdapterTypes&gt; builder = ImmutableList.builder();</b>
<b class="nc">&nbsp;    for (Entry&lt;AbstractDeclaring, Collection&lt;ValueType&gt;&gt; entry : byDeclaring.asMap().entrySet()) {</b>
<b class="nc">&nbsp;      String pack = Iterables.get(entry.getValue(), 0).$$package();</b>
<b class="nc">&nbsp;      builder.add(ImmutableOkTypeAdapterTypes.builder()</b>
<b class="nc">&nbsp;          .definedBy(entry.getKey())</b>
<b class="nc">&nbsp;          .packageGenerated(pack)</b>
<b class="nc">&nbsp;          .addAllTypes(entry.getValue())</b>
<b class="nc">&nbsp;          .build());</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
<b class="nc">&nbsp;    return builder.build();</b>
&nbsp;  }
&nbsp;
&nbsp;  static class AttributesByFirstLetter {
&nbsp;    final Multimap&lt;Character, ValueAttribute&gt; byFirst;
&nbsp;    final Map&lt;Character, Collection&lt;ValueAttribute&gt;&gt; asMap;
&nbsp;
<b class="nc">&nbsp;    AttributesByFirstLetter(Iterable&lt;ValueAttribute&gt; attributes) {</b>
<b class="nc">&nbsp;      ImmutableMultimap.Builder&lt;Character, ValueAttribute&gt; builder = ImmutableMultimap.builder();</b>
&nbsp;
<b class="nc">&nbsp;      for (ValueAttribute attribute : attributes) {</b>
<b class="nc">&nbsp;        String name = attribute.getMarshaledName();</b>
<b class="nc">&nbsp;        char firstChar = name.charAt(0);</b>
<b class="nc">&nbsp;        builder.put(firstChar, attribute);</b>
<b class="nc">&nbsp;      }</b>
&nbsp;
<b class="nc">&nbsp;      byFirst = builder.build();</b>
<b class="nc">&nbsp;      asMap = byFirst.asMap();</b>
&nbsp;    }
&nbsp;
&nbsp;    Collection&lt;ValueAttribute&gt; values() {
<b class="nc">&nbsp;      return byFirst.values();</b>
&nbsp;    }
&nbsp;
&nbsp;    boolean useFlatIfElse() {
<b class="nc">&nbsp;      return byFirst.keySet().size() &lt; 4</b>
<b class="nc">&nbsp;          || byFirst.values().size() &lt; 4;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  final Function&lt;Iterable&lt;ValueAttribute&gt;, AttributesByFirstLetter&gt; byFirstCharacter =</b>
<b class="nc">&nbsp;      new Function&lt;Iterable&lt;ValueAttribute&gt;, AttributesByFirstLetter&gt;() {</b>
&nbsp;        @Override
&nbsp;        public AttributesByFirstLetter apply(Iterable&lt;ValueAttribute&gt; attributes) {
<b class="nc">&nbsp;          return new AttributesByFirstLetter(attributes);</b>
&nbsp;        }
&nbsp;      };
&nbsp;
&nbsp;  @Generator.Typedef
&nbsp;  EnumAllDefinitions EnumAllDefinitions;
&nbsp;
&nbsp;  @Generator.Typedef
&nbsp;  EnumDefinition EnumDefinition;
&nbsp;
&nbsp;  @Generator.Typedef
&nbsp;  EnumConstant EnumConstant;
&nbsp;
&nbsp;  static class EnumAllDefinitions implements Function&lt;String, EnumDefinition&gt; {
<b class="nc">&nbsp;    final Map&lt;String, EnumDefinition&gt; definitionsByQualifiedName = Maps.newHashMap();</b>
<b class="nc">&nbsp;    final Set&lt;String&gt; takenSimpleNames = Sets.newHashSet();</b>
&nbsp;
<b class="nc">&nbsp;    EnumAllDefinitions(List&lt;ValueType&gt; types, AbstractDeclaring declaring) {</b>
<b class="nc">&nbsp;      for (ValueType t : types) {</b>
<b class="nc">&nbsp;        for (ValueAttribute v : t.getMarshaledAttributes()) {</b>
<b class="nc">&nbsp;          addEnumDefintions(declaring, v, ConvertionDirection.TO_STRING);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        for (ValueAttribute v : t.getUnmarshaledAttributes()) {</b>
<b class="nc">&nbsp;          addEnumDefintions(declaring, v, ConvertionDirection.FROM_STRING);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;      }</b>
&nbsp;    }
&nbsp;
&nbsp;    private void addEnumDefintions(
&nbsp;        AbstractDeclaring declaring,
&nbsp;        ValueAttribute v,
&nbsp;        ConvertionDirection direction) {
&nbsp;
<b class="nc">&nbsp;      if (!v.getJsonQualiferAnnotations().isEmpty()) {</b>
&nbsp;        // don&#39;t handle qualified enums as they should be
&nbsp;        // resolved using adapters etc
&nbsp;        return;
&nbsp;      }
&nbsp;
<b class="nc">&nbsp;      for (TypeElement e : v.getEnumElements()) {</b>
<b class="nc">&nbsp;        String qualified = e.getQualifiedName().toString();</b>
<b class="nc">&nbsp;        if (inDefinitionCoveredByAdapter(declaring, qualified)) {</b>
<b class="nc">&nbsp;          @Nullable EnumDefinition definition = definitionsByQualifiedName.get(qualified);</b>
<b class="nc">&nbsp;          if (definition == null) {</b>
<b class="nc">&nbsp;            String simple = unambigousSimpleName(takenSimpleNames, e);</b>
<b class="nc">&nbsp;            definition = new EnumDefinition(e, qualified, simple);</b>
<b class="nc">&nbsp;            definitionsByQualifiedName.put(qualified, definition);</b>
&nbsp;          }
<b class="nc">&nbsp;          definition.conversions.add(direction);</b>
&nbsp;        }
<b class="nc">&nbsp;      }</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean inDefinitionCoveredByAdapter(AbstractDeclaring declaring, String qualified) {
<b class="nc">&nbsp;      return qualified.startsWith(declaring.asPrefix());</b>
&nbsp;    }
&nbsp;
&nbsp;    private String unambigousSimpleName(Set&lt;String&gt; simpleNames, TypeElement e) {
<b class="nc">&nbsp;      String base = CaseFormat.UPPER_CAMEL.to(CaseFormat.LOWER_CAMEL, e.getSimpleName().toString());</b>
<b class="nc">&nbsp;      String simple = base;</b>
<b class="nc">&nbsp;      for (int c = 0; !simpleNames.add(simple); c++) {</b>
<b class="nc">&nbsp;        simple = base + c;</b>
&nbsp;      }
<b class="nc">&nbsp;      return simple;</b>
&nbsp;    }
&nbsp;
&nbsp;    Collection&lt;EnumDefinition&gt; all() {
<b class="nc">&nbsp;      return definitionsByQualifiedName.values();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public EnumDefinition apply(String input) {
<b class="nc">&nbsp;      return definitionsByQualifiedName.get(input);</b>
&nbsp;    }
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  enum ConvertionDirection {</b>
<b class="nc">&nbsp;    TO_STRING, FROM_STRING</b>
&nbsp;  }
&nbsp;
&nbsp;  static class EnumConstant {
&nbsp;    final String name;
&nbsp;    final String json;
&nbsp;
<b class="nc">&nbsp;    EnumConstant(String name, String json) {</b>
<b class="nc">&nbsp;      this.name = name;</b>
<b class="nc">&nbsp;      this.json = json;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  static class EnumDefinition {
&nbsp;    final String qualified;
&nbsp;    final String simple;
<b class="nc">&nbsp;    final Set&lt;ConvertionDirection&gt; conversions = EnumSet.noneOf(ConvertionDirection.class);</b>
<b class="nc">&nbsp;    final Multimap&lt;Character, EnumConstant&gt; byFirstLetter = HashMultimap.create();</b>
&nbsp;
<b class="nc">&nbsp;    EnumDefinition(TypeElement element, String qualified, String simple) {</b>
<b class="nc">&nbsp;      this.qualified = qualified;</b>
<b class="nc">&nbsp;      this.simple = simple;</b>
&nbsp;
<b class="nc">&nbsp;      for (Element e : element.getEnclosedElements()) {</b>
<b class="nc">&nbsp;        if (e.getKind() == ElementKind.ENUM_CONSTANT) {</b>
<b class="nc">&nbsp;          Optional&lt;OkNamedMirror&gt; nameAnnotation = OkNamedMirror.find(e);</b>
<b class="nc">&nbsp;          String name = e.getSimpleName().toString();</b>
<b class="nc">&nbsp;          String jsonName = name;</b>
&nbsp;
<b class="nc">&nbsp;          if (nameAnnotation.isPresent()) {</b>
<b class="nc">&nbsp;            String s = nameAnnotation.get().name();</b>
&nbsp;            // just ignore annotation with empty name
<b class="nc">&nbsp;            if (!s.isEmpty()) {</b>
<b class="nc">&nbsp;              jsonName = s;</b>
&nbsp;            }
&nbsp;          }
<b class="nc">&nbsp;          byFirstLetter.put(</b>
<b class="nc">&nbsp;              jsonName.charAt(0),</b>
&nbsp;              new EnumConstant(name, jsonName));
&nbsp;        }
<b class="nc">&nbsp;      }</b>
&nbsp;    }
&nbsp;
&nbsp;    boolean useFlatIfElse() {
<b class="nc">&nbsp;      return byFirstLetter.keySet().size() &lt; 4</b>
<b class="nc">&nbsp;          || byFirstLetter.values().size() &lt; 4;</b>
&nbsp;    }
&nbsp;
&nbsp;    Collection&lt;EnumConstant&gt; constants() {
<b class="nc">&nbsp;      return byFirstLetter.values();</b>
&nbsp;    }
&nbsp;
&nbsp;    boolean useToString() {
<b class="nc">&nbsp;      return conversions.contains(ConvertionDirection.TO_STRING);</b>
&nbsp;    }
&nbsp;
&nbsp;    boolean useFromString() {
<b class="nc">&nbsp;      return conversions.contains(ConvertionDirection.FROM_STRING);</b>
&nbsp;    }
&nbsp;  }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-11-04 15:34</div>
</div>
</body>
</html>
