


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > QueryBuilders</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.immutables.criteria.elasticsearch</a>
</div>

<h1>Coverage Summary for Class: QueryBuilders (org.immutables.criteria.elasticsearch)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">QueryBuilders</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
</tr>
  <tr>
    <td class="name">QueryBuilders$1</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$BoolQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/31)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$ConstantScoreQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$ExistsQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$IdsQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$MatchAllQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$PrefixQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$QueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$RangeQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/28)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$RegexpQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$TermQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$TermsQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">QueryBuilders$WildcardQueryBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/61)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/24)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/140)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2019 Immutables Authors and Contributors
&nbsp; * Copyright 2016-2018 Apache Software Foundation (ASF)
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *  http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.immutables.criteria.elasticsearch;
&nbsp;
&nbsp;import com.fasterxml.jackson.databind.JsonNode;
&nbsp;import com.fasterxml.jackson.databind.ObjectMapper;
&nbsp;import com.fasterxml.jackson.databind.node.ArrayNode;
&nbsp;import com.fasterxml.jackson.databind.node.ObjectNode;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.Objects;
&nbsp;
&nbsp;/**
&nbsp; * Utility class to generate elastic search queries. Most query builders have
&nbsp; * been copied from ES distribution. The reason we have separate definition is
&nbsp; * high-level client dependency on core modules (like lucene, netty, XContent etc.) which
&nbsp; * is not compatible between different major versions.
&nbsp; *
&nbsp; * &lt;p&gt;The goal of ES adapter is to
&nbsp; * be compatible with any elastic version or even to connect to clusters with different
&nbsp; * versions simultaneously.
&nbsp; *
&nbsp; * &lt;p&gt;Jackson API is used to generate ES query as JSON document.
&nbsp; * &lt;p&gt;Some parts of this class have been copied from &lt;a href=&quot;https://calcite.apache.org/&quot;&gt;Apache Calcite&lt;/a&gt; project.
&nbsp; */
<b class="nc">&nbsp;class QueryBuilders {</b>
&nbsp;
&nbsp;  private QueryBuilders() {}
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing a term.
&nbsp;   *
&nbsp;   * @param name  The name of the field
&nbsp;   * @param value The value of the term
&nbsp;   */
&nbsp;  static TermQueryBuilder termQuery(String name, String value) {
<b class="nc">&nbsp;    return new TermQueryBuilder(name, value);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing a term.
&nbsp;   *
&nbsp;   * @param name  The name of the field
&nbsp;   * @param value The value of the term
&nbsp;   */
&nbsp;  static TermQueryBuilder termQuery(String name, int value) {
<b class="nc">&nbsp;    return new TermQueryBuilder(name, value);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing a single character term.
&nbsp;   *
&nbsp;   * @param name  The name of the field
&nbsp;   * @param value The value of the term
&nbsp;   */
&nbsp;  static TermQueryBuilder termQuery(String name, char value) {
<b class="nc">&nbsp;    return new TermQueryBuilder(name, value);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing a term.
&nbsp;   *
&nbsp;   * @param name  The name of the field
&nbsp;   * @param value The value of the term
&nbsp;   */
&nbsp;  static TermQueryBuilder termQuery(String name, long value) {
<b class="nc">&nbsp;    return new TermQueryBuilder(name, value);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing a term.
&nbsp;   *
&nbsp;   * @param name  The name of the field
&nbsp;   * @param value The value of the term
&nbsp;   */
&nbsp;  static TermQueryBuilder termQuery(String name, float value) {
<b class="nc">&nbsp;    return new TermQueryBuilder(name, value);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing a term.
&nbsp;   *
&nbsp;   * @param name  The name of the field
&nbsp;   * @param value The value of the term
&nbsp;   */
&nbsp;  static TermQueryBuilder termQuery(String name, double value) {
<b class="nc">&nbsp;    return new TermQueryBuilder(name, value);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing a term.
&nbsp;   *
&nbsp;   * @param name  The name of the field
&nbsp;   * @param value The value of the term
&nbsp;   */
&nbsp;  static TermQueryBuilder termQuery(String name, boolean value) {
<b class="nc">&nbsp;    return new TermQueryBuilder(name, value);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing a term.
&nbsp;   *
&nbsp;   * @param name  The name of the field
&nbsp;   * @param value The value of the term
&nbsp;   */
&nbsp;  static TermQueryBuilder termQuery(String name, Object value) {
<b class="nc">&nbsp;    return new TermQueryBuilder(name, value);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A filer for a field based on several terms matching on any of them.
&nbsp;   *
&nbsp;   * @param name   The field name
&nbsp;   * @param values The terms
&nbsp;   */
&nbsp;  static TermsQueryBuilder termsQuery(String name, Iterable&lt;?&gt; values) {
<b class="nc">&nbsp;    return new TermsQueryBuilder(name, values);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents within an range of terms.
&nbsp;   *
&nbsp;   * @param name The field name
&nbsp;   */
&nbsp;  static RangeQueryBuilder rangeQuery(String name) {
<b class="nc">&nbsp;    return new RangeQueryBuilder(name);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing terms with a specified regular expression.
&nbsp;   *
&nbsp;   * @param name   The name of the field
&nbsp;   * @param regexp The regular expression
&nbsp;   */
&nbsp;  static RegexpQueryBuilder regexpQuery(String name, String regexp) {
<b class="nc">&nbsp;    return new RegexpQueryBuilder(name, regexp);</b>
&nbsp;  }
&nbsp;
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents matching boolean combinations of other queries.
&nbsp;   */
&nbsp;  static BoolQueryBuilder boolQuery() {
<b class="nc">&nbsp;    return new BoolQueryBuilder();</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A query that wraps another query and simply returns a constant score equal to the
&nbsp;   * query boost for every document in the query.
&nbsp;   *
&nbsp;   * @param queryBuilder The query to wrap in a constant score query
&nbsp;   */
&nbsp;  static ConstantScoreQueryBuilder constantScoreQuery(QueryBuilder queryBuilder) {
<b class="nc">&nbsp;    return new ConstantScoreQueryBuilder(queryBuilder);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A filter to filter only documents where a field exists in them.
&nbsp;   *
&nbsp;   * @param name The name of the field
&nbsp;   */
&nbsp;  static ExistsQueryBuilder existsQuery(String name) {
<b class="nc">&nbsp;    return new ExistsQueryBuilder(name);</b>
&nbsp;  }
&nbsp;
&nbsp;
&nbsp;  static PrefixQueryBuilder prefixQuery(String name, String prefix) {
<b class="nc">&nbsp;    return new PrefixQueryBuilder(name, prefix);</b>
&nbsp;  }
&nbsp;
&nbsp;  static WildcardQueryBuilder wildcardQuery(String name, String wildcard) {
<b class="nc">&nbsp;    return new WildcardQueryBuilder(name, wildcard);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Filter on document ID ({@code _id}) values
&nbsp;   */
&nbsp;  static IdsQueryBuilder idsQuery(Iterable&lt;?&gt; values) {
<b class="nc">&nbsp;    return new IdsQueryBuilder(values);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A query that matches on all documents.
&nbsp;   */
&nbsp;  static MatchAllQueryBuilder matchAll() {
<b class="nc">&nbsp;    return new MatchAllQueryBuilder();</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Base class to build ES queries
&nbsp;   */
<b class="nc">&nbsp;  abstract static class QueryBuilder {</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Convert existing query to JSON format using jackson API.
&nbsp;     */
&nbsp;    abstract ObjectNode toJson(ObjectMapper mapper);
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Query for boolean logic
&nbsp;   */
<b class="nc">&nbsp;  static class BoolQueryBuilder extends QueryBuilder {</b>
<b class="nc">&nbsp;    private final List&lt;QueryBuilder&gt; mustClauses = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    private final List&lt;QueryBuilder&gt; mustNotClauses = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    private final List&lt;QueryBuilder&gt; filterClauses = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    private final List&lt;QueryBuilder&gt; shouldClauses = new ArrayList&lt;&gt;();</b>
&nbsp;
&nbsp;    BoolQueryBuilder must(QueryBuilder queryBuilder) {
<b class="nc">&nbsp;      Objects.requireNonNull(queryBuilder, &quot;queryBuilder&quot;);</b>
<b class="nc">&nbsp;      mustClauses.add(queryBuilder);</b>
<b class="nc">&nbsp;      return this;</b>
&nbsp;    }
&nbsp;
&nbsp;    BoolQueryBuilder filter(QueryBuilder queryBuilder) {
<b class="nc">&nbsp;      Objects.requireNonNull(queryBuilder, &quot;queryBuilder&quot;);</b>
<b class="nc">&nbsp;      filterClauses.add(queryBuilder);</b>
<b class="nc">&nbsp;      return this;</b>
&nbsp;    }
&nbsp;
&nbsp;    BoolQueryBuilder mustNot(QueryBuilder queryBuilder) {
<b class="nc">&nbsp;      Objects.requireNonNull(queryBuilder, &quot;queryBuilder&quot;);</b>
<b class="nc">&nbsp;      mustNotClauses.add(queryBuilder);</b>
<b class="nc">&nbsp;      return this;</b>
&nbsp;    }
&nbsp;
&nbsp;    BoolQueryBuilder should(QueryBuilder queryBuilder) {
<b class="nc">&nbsp;      Objects.requireNonNull(queryBuilder, &quot;queryBuilder&quot;);</b>
<b class="nc">&nbsp;      shouldClauses.add(queryBuilder);</b>
<b class="nc">&nbsp;      return this;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      ObjectNode bool = result.with(&quot;bool&quot;);</b>
<b class="nc">&nbsp;      writeJsonArray(&quot;must&quot;, mustClauses, bool, mapper);</b>
<b class="nc">&nbsp;      writeJsonArray(&quot;filter&quot;, filterClauses, bool, mapper);</b>
<b class="nc">&nbsp;      writeJsonArray(&quot;must_not&quot;, mustNotClauses, bool, mapper);</b>
<b class="nc">&nbsp;      writeJsonArray(&quot;should&quot;, shouldClauses, bool, mapper);</b>
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static void writeJsonArray(String field, List&lt;QueryBuilder&gt; clauses, ObjectNode node, ObjectMapper mapper) {
<b class="nc">&nbsp;      if (clauses.isEmpty()) {</b>
&nbsp;        return;
&nbsp;      }
&nbsp;
<b class="nc">&nbsp;      if (clauses.size() == 1) {</b>
<b class="nc">&nbsp;        node.set(field, clauses.get(0).toJson(mapper));</b>
&nbsp;      } else {
<b class="nc">&nbsp;        final ArrayNode arrayNode = node.withArray(field);</b>
<b class="nc">&nbsp;        for (QueryBuilder clause: clauses) {</b>
<b class="nc">&nbsp;          arrayNode.add(clause.toJson(mapper));</b>
<b class="nc">&nbsp;        }</b>
&nbsp;      }
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents containing a term.
&nbsp;   */
<b class="nc">&nbsp;  static class TermQueryBuilder extends QueryBuilder {</b>
&nbsp;    private final String fieldName;
&nbsp;    private final Object value;
&nbsp;
<b class="nc">&nbsp;    private TermQueryBuilder(final String fieldName, final Object value) {</b>
<b class="nc">&nbsp;      this.fieldName = Objects.requireNonNull(fieldName, &quot;fieldName&quot;);</b>
<b class="nc">&nbsp;      this.value = Objects.requireNonNull(value, &quot;value&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      result.with(&quot;term&quot;).set(fieldName, toJsonValue(value, mapper));</b>
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A filter for a field based on several terms matching on any of them.
&nbsp;   */
<b class="nc">&nbsp;  private static class TermsQueryBuilder extends QueryBuilder {</b>
&nbsp;    private final String fieldName;
&nbsp;    private final Iterable&lt;?&gt; values;
&nbsp;
<b class="nc">&nbsp;    private TermsQueryBuilder(final String fieldName, final Iterable&lt;?&gt; values) {</b>
<b class="nc">&nbsp;      this.fieldName = Objects.requireNonNull(fieldName, &quot;fieldName&quot;);</b>
<b class="nc">&nbsp;      this.values = Objects.requireNonNull(values, &quot;values&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper)  {
<b class="nc">&nbsp;      ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      final ArrayNode terms = result.with(&quot;terms&quot;).withArray(fieldName);</b>
<b class="nc">&nbsp;      for (Object value: values) {</b>
<b class="nc">&nbsp;        terms.add(toJsonValue(value, mapper));</b>
<b class="nc">&nbsp;      }</b>
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that matches documents within an range of terms.
&nbsp;   */
<b class="nc">&nbsp;  static class RangeQueryBuilder extends QueryBuilder {</b>
&nbsp;    private final String fieldName;
&nbsp;
&nbsp;    private Object lt;
&nbsp;    private boolean lte;
&nbsp;    private Object gt;
&nbsp;    private boolean gte;
&nbsp;
&nbsp;    private String format;
&nbsp;
<b class="nc">&nbsp;    private RangeQueryBuilder(final String fieldName) {</b>
<b class="nc">&nbsp;      this.fieldName = Objects.requireNonNull(fieldName, &quot;fieldName&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    private RangeQueryBuilder to(Object value, boolean lte) {
<b class="nc">&nbsp;      this.lt = Objects.requireNonNull(value, &quot;value&quot;);</b>
<b class="nc">&nbsp;      this.lte = lte;</b>
<b class="nc">&nbsp;      return this;</b>
&nbsp;    }
&nbsp;
&nbsp;    private RangeQueryBuilder from(Object value, boolean gte) {
<b class="nc">&nbsp;      this.gt = Objects.requireNonNull(value, &quot;value&quot;);</b>
<b class="nc">&nbsp;      this.gte = gte;</b>
<b class="nc">&nbsp;      return this;</b>
&nbsp;    }
&nbsp;
&nbsp;    RangeQueryBuilder lt(Object value) {
<b class="nc">&nbsp;      return to(value, false);</b>
&nbsp;    }
&nbsp;
&nbsp;    RangeQueryBuilder lte(Object value) {
<b class="nc">&nbsp;      return to(value, true);</b>
&nbsp;    }
&nbsp;
&nbsp;    RangeQueryBuilder gt(Object value) {
<b class="nc">&nbsp;      return from(value, false);</b>
&nbsp;    }
&nbsp;
&nbsp;    RangeQueryBuilder gte(Object value) {
<b class="nc">&nbsp;      return from(value, true);</b>
&nbsp;    }
&nbsp;
&nbsp;    RangeQueryBuilder format(String format) {
<b class="nc">&nbsp;      this.format = format;</b>
<b class="nc">&nbsp;      return this;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      if (lt == null &amp;&amp; gt == null) {</b>
<b class="nc">&nbsp;        throw new IllegalStateException(&quot;Either lower or upper bound should be provided&quot;);</b>
&nbsp;      }
&nbsp;
<b class="nc">&nbsp;      final ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      final ObjectNode range = result.with(&quot;range&quot;).with(fieldName);</b>
<b class="nc">&nbsp;      if (gt != null) {</b>
<b class="nc">&nbsp;        final String op = gte ? &quot;gte&quot; : &quot;gt&quot;;</b>
<b class="nc">&nbsp;        range.set(op, toJsonValue(gt, mapper));</b>
&nbsp;      }
&nbsp;
<b class="nc">&nbsp;      if (lt != null) {</b>
<b class="nc">&nbsp;        final String op = lte ? &quot;lte&quot; : &quot;lt&quot;;</b>
<b class="nc">&nbsp;        range.set(op, toJsonValue(lt, mapper));</b>
&nbsp;      }
&nbsp;
<b class="nc">&nbsp;      if (format != null) {</b>
<b class="nc">&nbsp;        range.put(&quot;format&quot;, format);</b>
&nbsp;      }
&nbsp;
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A Query that does fuzzy matching for a specific value.
&nbsp;   */
&nbsp;  static class RegexpQueryBuilder extends QueryBuilder {
&nbsp;    private final String fieldName;
&nbsp;    private final String value;
&nbsp;
<b class="nc">&nbsp;    RegexpQueryBuilder(final String fieldName, final String value) {</b>
<b class="nc">&nbsp;      this.fieldName = fieldName;</b>
<b class="nc">&nbsp;      this.value = value;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      result.with(&quot;regexp&quot;).with(fieldName).put(&quot;value&quot;, value);</b>
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Constructs a query that only match on documents that the field has a value in them.
&nbsp;   */
&nbsp;  static class ExistsQueryBuilder extends QueryBuilder {
&nbsp;    private final String fieldName;
&nbsp;
<b class="nc">&nbsp;    ExistsQueryBuilder(final String fieldName) {</b>
<b class="nc">&nbsp;      this.fieldName = Objects.requireNonNull(fieldName, &quot;fieldName&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      result.with(&quot;exists&quot;).put(&quot;field&quot;, fieldName);</b>
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Constructs a query that only match on documents that the field has a value in them.
&nbsp;   */
&nbsp;  static class PrefixQueryBuilder extends QueryBuilder {
&nbsp;    private final String fieldName;
&nbsp;    private final String value;
&nbsp;
<b class="nc">&nbsp;    PrefixQueryBuilder(final String fieldName, String value) {</b>
<b class="nc">&nbsp;      this.fieldName = Objects.requireNonNull(fieldName, &quot;fieldName&quot;);</b>
<b class="nc">&nbsp;      this.value = Objects.requireNonNull(value, &quot;value&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      result.with(&quot;prefix&quot;).put(fieldName, value);</b>
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
<b class="nc">&nbsp;  static class WildcardQueryBuilder extends QueryBuilder {</b>
&nbsp;    private final String fieldName;
&nbsp;    private final String wildcard;
&nbsp;
<b class="nc">&nbsp;    private WildcardQueryBuilder(String fieldName, String wildcard) {</b>
<b class="nc">&nbsp;      this.fieldName = Objects.requireNonNull(fieldName, &quot;fieldName&quot;);</b>
<b class="nc">&nbsp;      this.wildcard = Objects.requireNonNull(wildcard, &quot;wildcard&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      result.with(&quot;wildcard&quot;).put(fieldName, wildcard);</b>
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * @see &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html&quot;&gt;IDs query&lt;/a&gt;
&nbsp;   */
&nbsp;  static class IdsQueryBuilder extends QueryBuilder {
&nbsp;    private final Iterable&lt;?&gt; values;
&nbsp;
<b class="nc">&nbsp;    IdsQueryBuilder(Iterable&lt;?&gt; values) {</b>
<b class="nc">&nbsp;      this.values = Objects.requireNonNull(values, &quot;values&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      ArrayNode array = result.with(&quot;ids&quot;).withArray(&quot;values&quot;);</b>
<b class="nc">&nbsp;      values.forEach(v -&gt; array.add(toJsonValue(v, mapper)));</b>
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A query that wraps a filter and simply returns a constant score equal to the
&nbsp;   * query boost for every document in the filter.
&nbsp;   */
<b class="nc">&nbsp;  static class ConstantScoreQueryBuilder extends QueryBuilder {</b>
&nbsp;
&nbsp;    private final QueryBuilder builder;
&nbsp;
<b class="nc">&nbsp;    private ConstantScoreQueryBuilder(final QueryBuilder builder) {</b>
<b class="nc">&nbsp;      this.builder = Objects.requireNonNull(builder, &quot;builder&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      ObjectNode result = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      result.with(&quot;constant_score&quot;).set(&quot;filter&quot;, builder.toJson(mapper));</b>
<b class="nc">&nbsp;      return result;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * A query that matches on all documents.
&nbsp;   * &lt;pre&gt;
&nbsp;   *   {
&nbsp;   *     &quot;match_all&quot;: {}
&nbsp;   *   }
&nbsp;   * &lt;/pre&gt;
&nbsp;   */
<b class="nc">&nbsp;  static class MatchAllQueryBuilder extends QueryBuilder {</b>
&nbsp;
<b class="nc">&nbsp;    private MatchAllQueryBuilder() {}</b>
&nbsp;
&nbsp;    @Override
&nbsp;    ObjectNode toJson(ObjectMapper mapper) {
<b class="nc">&nbsp;      ObjectNode node = mapper.createObjectNode();</b>
<b class="nc">&nbsp;      node.putObject(&quot;match_all&quot;);</b>
<b class="nc">&nbsp;      return node;</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Write usually simple (scalar) value (string, number, boolean or null) to json output.
&nbsp;   * In case of complex objects delegates to jackson serialization.
&nbsp;   *
&nbsp;   * @param value JSON value to write
&nbsp;   */
&nbsp;  private static JsonNode toJsonValue(Object value, ObjectMapper mapper) {
<b class="nc">&nbsp;    if (value == null) {</b>
<b class="nc">&nbsp;      return mapper.getNodeFactory().nullNode();</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    return mapper.convertValue(value, JsonNode.class);</b>
&nbsp;  }
&nbsp;}
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-11-04 15:34</div>
</div>
</body>
</html>
